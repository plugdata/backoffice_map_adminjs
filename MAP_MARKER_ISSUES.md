# ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏∏‡∏î‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (Map Marker Issues)

## üîç **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö**

### 1. **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å: ‡∏´‡∏°‡∏∏‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ**
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏Ñ‡πà‡∏≤ latitude ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
- ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô input field ‡πÑ‡∏°‡πà sync ‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡∏°‡∏∏‡∏î
- ‡∏´‡∏°‡∏∏‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏≤‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à

### 2. **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤**

#### **A. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ State ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô**
```javascript
// ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ store ‡πÅ‡∏•‡∏∞ local state ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
const { latitude, longitude, setLatLng } = useMapStore() // ‡∏à‡∏≤‡∏Å store
const [latitude, setLatitude] = useState() // local state
```

#### **B. ‡∏Å‡∏≤‡∏£ Loop ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Store ‡πÅ‡∏•‡∏∞ Component**
```javascript
// ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å setLatLng ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
onDragEnd={(lat, lng) => {
  setLatitude(lat)           // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï local state
  setLatLng(lat, lng)        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï store
  onChange?.("latitude", lat) // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï form
}}
```

#### **C. ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Tolerance ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô**
```javascript
// ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
const latDiff = Math.abs(latitude - oldLat)
const lngDiff = Math.abs(longitude - oldLng)
const tolerance = 0.000001

if (latDiff > tolerance || lngDiff > tolerance) {
  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å
}
```

## ‚úÖ **‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

### **1. ‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ State**
```javascript
// ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡πÉ‡∏ä‡πâ local state ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö latitude
const { longitude, setLatLng } = useMapStore() // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ longitude ‡∏à‡∏≤‡∏Å store
const [latitude, setLatitude] = useState(DEFAULT_LAT) // latitude ‡πÄ‡∏õ‡πá‡∏ô local state
```

### **2. ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á setLatLng**
```javascript
// ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö tolerance
setLatLng: (latitude, longitude) => {
  set({ latitude, longitude })
}
```

### **3. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ onDragEnd**
```javascript
// ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï local state ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï store
onDragEnd={(lat, lng) => {
  setIsDragging(true)
  
  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï local latitude state
  setLatitude(lat)
  
  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï store
  setLatLng(lat, lng)
  
  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï form
  onChange?.("latitude", lat)
  onChange?.("longitude", lng)
  
  setTimeout(() => setIsDragging(false), 100)
}}
```

### **4. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ Loop**
```javascript
// ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡πÉ‡∏ä‡πâ flag ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ loop
const [isDragging, setIsDragging] = useState(false)

onChange={(e) => {
  if (isDragging) {
    return // ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏≤‡∏Å
  }
  // ... rest of logic
}}
```

## üõ†Ô∏è **‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥**

### **1. ‡∏ï‡∏±‡∏î Code ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏Å**
- ‡∏•‡∏ö console.log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö
- ‡∏•‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô testlatlong_

### **2. ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á Store**
```javascript
// ‡πÄ‡∏î‡∏¥‡∏°
setLatLng: (latitude, longitude) => {
  const { latitude: oldLat, longitude: oldLng } = get()
  const latDiff = Math.abs(latitude - oldLat)
  const lngDiff = Math.abs(longitude - oldLng)
  const tolerance = 0.000001
  
  if (latDiff > tolerance || lngDiff > tolerance) {
    set({ latitude, longitude })
  }
}

// ‡πÉ‡∏´‡∏°‡πà
setLatLng: (latitude, longitude) => {
  set({ latitude, longitude })
}
```

### **3. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Input**
```javascript
// Latitude input - ‡πÉ‡∏ä‡πâ local state
onChange={(e) => {
  if (isDragging) return
  
  const val = parseFloat(e.target.value)
  if (!isNaN(val)) {
    setLatitude(val)           // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï local state
    setLatLng(val, longitude)  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï store
    onChange?.("latitude", val)
    onChange?.("longitude", longitude)
  }
}}

// Longitude input - ‡πÉ‡∏ä‡πâ store
onChange={(e) => {
  if (isDragging) return
  
  const val = parseFloat(e.target.value)
  if (!isNaN(val)) {
    setLatLng(latitude, val)   // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï store
    onChange?.("latitude", latitude)
    onChange?.("longitude", val)
  }
}}
```

## üìã **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢**

### **MapField Component:**
- `latitude` - local state (useState)
- `setLatitude()` - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï latitude
- `longitude` - ‡∏à‡∏≤‡∏Å store
- `setLatLng()` - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡πâ‡∏á latitude ‡πÅ‡∏•‡∏∞ longitude ‡πÉ‡∏ô store

### **Store:**
- `latitude` - ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ latitude
- `longitude` - ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ longitude
- `setLatLng()` - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- `resetMap()` - ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤

## üéØ **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:
- ‚úÖ ‡∏´‡∏°‡∏∏‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚úÖ ‡∏Ñ‡πà‡∏≤ latitude/longitude ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡∏°‡∏∏‡∏î
- ‚úÖ Input fields sync ‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡∏°‡∏∏‡∏î
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ loop ‡∏´‡∏£‡∏∑‡∏≠ reset ‡∏Ñ‡πà‡∏≤
- ‚úÖ ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢

## üîß **‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö**

1. **‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î** - ‡∏´‡∏°‡∏∏‡∏î‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏¢‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
2. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Latitude** - ‡∏´‡∏°‡∏∏‡∏î‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
3. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Longitude** - ‡∏´‡∏°‡∏∏‡∏î‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
4. **‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï** - ‡∏´‡∏°‡∏∏‡∏î‡∏Ñ‡∏ß‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
5. **‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏´‡∏°‡∏∏‡∏î** - ‡∏´‡∏°‡∏∏‡∏î‡∏Ñ‡∏ß‡∏£‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà

---

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ state ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ store ‡∏Å‡∏±‡∏ö local state ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ latitude ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô local state ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
