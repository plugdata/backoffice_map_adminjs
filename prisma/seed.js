// ========================================
// Seed Data for Role-Based Access Control
// ========================================

import { PrismaClient } from '@prisma/client'
import bcrypt from 'bcryptjs'

const prisma = new PrismaClient()

async function main() {
  console.log('üå± Starting seed...')

  // ========================================
  // CREATE DEPARTMENTS
  // ========================================
  
  console.log('üè¢ Creating departments...')
  const hrDepartment = await prisma.department.upsert({
    where: { name: 'HR Department' },
    update: {},
    create: {
      name: 'HR Department',
      description: 'Human Resources Department'
    }
  })

  const itDepartment = await prisma.department.upsert({
    where: { name: 'IT Department' },
    update: {},
    create: {
      name: 'IT Department',
      description: 'Information Technology Department'
    }
  })

  const financeDepartment = await prisma.department.upsert({
    where: { name: 'Finance Department' },
    update: {},
    create: {
      name: 'Finance Department',
      description: 'Finance and Accounting Department'
    }
  })

  // ========================================
  // CREATE PERMISSIONS
  // ========================================
  
  const permissions = [
    // Document Permissions
    { name: 'document:create', description: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà', resource: 'document', action: 'create' },
    { name: 'document:read', description: '‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', resource: 'document', action: 'read' },
    { name: 'document:update', description: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', resource: 'document', action: 'update' },
    { name: 'document:delete', description: '‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', resource: 'document', action: 'delete' },
    { name: 'document:approve', description: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', resource: 'document', action: 'approve' },
    { name: 'document:reject', description: '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', resource: 'document', action: 'reject' },
    
    // User Permissions
    { name: 'user:create', description: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà', resource: 'user', action: 'create' },
    { name: 'user:read', description: '‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', resource: 'user', action: 'read' },
    { name: 'user:update', description: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', resource: 'user', action: 'update' },
    { name: 'user:delete', description: '‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', resource: 'user', action: 'delete' },
    
    // Role Permissions
    { name: 'role:create', description: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏´‡∏°‡πà', resource: 'role', action: 'create' },
    { name: 'role:read', description: '‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó', resource: 'role', action: 'read' },
    { name: 'role:update', description: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó', resource: 'role', action: 'update' },
    { name: 'role:delete', description: '‡∏•‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó', resource: 'role', action: 'delete' },
    
    // Permission Permissions
    { name: 'permission:create', description: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡∏°‡πà', resource: 'permission', action: 'create' },
    { name: 'permission:read', description: '‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå', resource: 'permission', action: 'read' },
    { name: 'permission:update', description: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå', resource: 'permission', action: 'update' },
    { name: 'permission:delete', description: '‡∏•‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå', resource: 'permission', action: 'delete' },
    
    // Department Permissions
    { name: 'department:create', description: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏´‡∏°‡πà', resource: 'department', action: 'create' },
    { name: 'department:read', description: '‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å', resource: 'department', action: 'read' },
    { name: 'department:update', description: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ú‡∏ô‡∏Å', resource: 'department', action: 'update' },
    { name: 'department:delete', description: '‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å', resource: 'department', action: 'delete' },
    
    // System Permissions
    { name: 'system:admin', description: '‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', resource: 'system', action: 'admin' },
    { name: 'system:reports', description: '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', resource: 'system', action: 'reports' },
  ]

  console.log('üìù Creating permissions...')
  for (const permission of permissions) {
    await prisma.permission.upsert({
      where: { name: permission.name },
      update: permission,
      create: permission,
    })
  }

  // ========================================
  // CREATE ROLES
  // ========================================
  
  const roles = [
    {
      name: 'Super Admin',
      description: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î - ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö',
    },
    {
      name: 'CEO',
      description: '‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢',
    },
    {
      name: 'HR Manager',
      description: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
    },
    {
      name: 'Department Manager',
      description: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á',
    },
    {
      name: 'Document Creator',
      description: '‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á',
    },
    {
      name: 'Document Reviewer',
      description: '‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
    },
    {
      name: 'Viewer',
      description: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ - ‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
    },
  ]

  console.log('üë• Creating roles...')
  for (const role of roles) {
    await prisma.role.upsert({
      where: { name: role.name },
      update: role,
      create: role,
    })
  }

  // ========================================
  // ASSIGN PERMISSIONS TO ROLES
  // ========================================
  
  console.log('üîó Assigning permissions to roles...')
  
  // Super Admin - ‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
  const superAdminRole = await prisma.role.findUnique({ where: { name: 'Super Admin' } })
  const allPermissions = await prisma.permission.findMany()
  
  for (const permission of allPermissions) {
    await prisma.permission.update({
      where: { id: permission.id },
      data: { roleId: superAdminRole.id }
    })
  }

  // HR Manager - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ HR
  const hrManagerRole = await prisma.role.findUnique({ where: { name: 'HR Manager' } })
  const hrPermissions = await prisma.permission.findMany({
    where: {
      OR: [
        { resource: 'user' },
        { resource: 'document' },
        { resource: 'department' },
        { name: 'system:reports' },
      ],
    },
  })
  
  for (const permission of hrPermissions) {
    await prisma.permission.update({
      where: { id: permission.id },
      data: { roleId: hrManagerRole.id }
    })
  }

  // CEO - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
  const ceoRole = await prisma.role.findUnique({ where: { name: 'CEO' } })
  const ceoPermissions = await prisma.permission.findMany({
    where: {
      OR: [
        { name: 'document:read' },
        { name: 'document:approve' },
        { name: 'document:reject' },
        { name: 'system:reports' },
      ],
    },
  })
  
  for (const permission of ceoPermissions) {
    await prisma.permission.update({
      where: { id: permission.id },
      data: { roleId: ceoRole.id }
    })
  }

  // Department Manager - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å
  const deptManagerRole = await prisma.role.findUnique({ where: { name: 'Department Manager' } })
  const deptManagerPermissions = await prisma.permission.findMany({
    where: {
      OR: [
        { name: 'document:create' },
        { name: 'document:read' },
        { name: 'document:update' },
        { name: 'document:approve' },
        { name: 'document:reject' },
        { name: 'user:read' },
      ],
    },
  })
  
  for (const permission of deptManagerPermissions) {
    await prisma.permission.update({
      where: { id: permission.id },
      data: { roleId: deptManagerRole.id }
    })
  }

  // Document Creator - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
  const creatorRole = await prisma.role.findUnique({ where: { name: 'Document Creator' } })
  const creatorPermissions = await prisma.permission.findMany({
    where: {
      OR: [
        { name: 'document:create' },
        { name: 'document:read' },
        { name: 'document:update' },
      ],
    },
  })
  
  for (const permission of creatorPermissions) {
    await prisma.permission.update({
      where: { id: permission.id },
      data: { roleId: creatorRole.id }
    })
  }

  // Document Reviewer - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
  const reviewerRole = await prisma.role.findUnique({ where: { name: 'Document Reviewer' } })
  const reviewerPermissions = await prisma.permission.findMany({
    where: {
      OR: [
        { name: 'document:read' },
        { name: 'document:approve' },
        { name: 'document:reject' },
      ],
    },
  })
  
  for (const permission of reviewerPermissions) {
    await prisma.permission.update({
      where: { id: permission.id },
      data: { roleId: reviewerRole.id }
    })
  }

  // Viewer - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  const viewerRole = await prisma.role.findUnique({ where: { name: 'Viewer' } })
  const viewerPermission = await prisma.permission.findUnique({ where: { name: 'document:read' } })
  
  await prisma.permission.update({
    where: { id: viewerPermission.id },
    data: { roleId: viewerRole.id }
  })

  // ========================================
  // CREATE SUPER ADMIN USER
  // ========================================
  
  console.log('üëë Creating Super Admin user...')
  const hashedPassword = await bcrypt.hash('admin123', 12)
  
  const superAdminUser = await prisma.user.upsert({
    where: { email: 'admin@docflow.com' },
    update: {},
    create: {
      email: 'admin@docflow.com',
      username: 'admin',
      password: hashedPassword,
      firstName: 'Super',
      lastName: 'Admin',
      employeeId: 'ADMIN001',
      departmentId: hrDepartment.id,
      isActive: true
    }
  })

  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Super Admin role ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  await prisma.user.update({
    where: { id: superAdminUser.id },
    data: { roleId: superAdminRole.id }
  })

  // ========================================
  // CREATE SAMPLE USERS
  // ========================================
  
  console.log('üë§ Creating sample users...')
  
  // CEO
  const ceoUser = await prisma.user.upsert({
    where: { email: 'ceo@docflow.com' },
    update: {},
    create: {
      email: 'ceo@docflow.com',
      username: 'ceo',
      password: hashedPassword,
      firstName: 'CEO',
      lastName: 'Executive',
      employeeId: 'CEO001',
      departmentId: hrDepartment.id,
      roleId: ceoRole.id,
      isActive: true
    }
  })

  // HR Manager
  const hrManagerUser = await prisma.user.upsert({
    where: { email: 'hr@docflow.com' },
    update: {},
    create: {
      email: 'hr@docflow.com',
      username: 'hr_manager',
      password: hashedPassword,
      firstName: 'HR',
      lastName: 'Manager',
      employeeId: 'HR001',
      departmentId: hrDepartment.id,
      roleId: hrManagerRole.id,
      isActive: true
    }
  })

  // IT Manager
  const itManagerUser = await prisma.user.upsert({
    where: { email: 'it@docflow.com' },
    update: {},
    create: {
      email: 'it@docflow.com',
      username: 'it_manager',
      password: hashedPassword,
      firstName: 'IT',
      lastName: 'Manager',
      employeeId: 'IT001',
      departmentId: itDepartment.id,
      roleId: deptManagerRole.id,
      isActive: true
    }
  })

  // Regular User
  const regularUser = await prisma.user.upsert({
    where: { email: 'user@docflow.com' },
    update: {},
    create: {
      email: 'user@docflow.com',
      username: 'regular_user',
      password: hashedPassword,
      firstName: 'Regular',
      lastName: 'User',
      employeeId: 'USER001',
      departmentId: financeDepartment.id,
      roleId: creatorRole.id,
      isActive: true
    }
  })

  console.log('‚úÖ Seed completed successfully!')
  console.log('\nüìã Default Login Credentials:')
  console.log('üëë Super Admin: admin@docflow.com / admin123')
  console.log('üëî CEO: ceo@docflow.com / admin123')
  console.log('üë§ HR Manager: hr@docflow.com / admin123')
  console.log('üë®‚Äçüíº IT Manager: it@docflow.com / admin123')
  console.log('üë§ Regular User: user@docflow.com / admin123')
}

main()
  .catch((e) => {
    console.error('‚ùå Seed failed:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  }) 