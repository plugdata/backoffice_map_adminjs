# ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Mojibake Encoding

## üîç ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

### ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Mojibake
```
‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: √†¬∏¬™√†¬∏¬£√†¬∏¬∏√†¬∏√†¬π√†¬∏√†¬∏¬•√†¬∏√†¬π√†¬∏¬ß√†¬∏¬•√†¬∏¬≤√†¬∏¬≠√†¬π√†¬∏¬≤√†¬∏√†¬π√†¬∏√†¬π√†¬∏√†¬∏√†¬π√†¬∏¬≥√†¬∏√†¬π√†¬∏¬≥√†¬∏√†¬∏¬≠√†¬∏.pdf
‚úÖ ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô: ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡πà‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡πâ‡∏≥‡∏ô‡πâ‡∏≥‡∏ö‡∏≠‡∏á.pdf
```

### ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô UTF-8 bytes ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡πÅ‡∏ï‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô API ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô frontend ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á encoding ‡∏ú‡∏¥‡∏î
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ UTF-8 bytes ‡∏ñ‡∏π‡∏Å‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô Latin-1 characters

## ‚úÖ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fixMojibakeEncoding**
```javascript
function fixMojibakeEncoding(text) {
  if (!text || typeof text !== 'string') {
    return text
  }

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ Mojibake encoding ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (!text.includes('√†¬∏') && !text.includes('√†¬π') && !text.includes('√†¬∏¬≠')) {
    return text
  }

  // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ Buffer (Node.js)
  try {
    if (typeof Buffer !== 'undefined') {
      const buffer = Buffer.from(text, 'latin1')
      const decoded = buffer.toString('utf8')
      if (decoded !== text && !decoded.includes('√†¬∏')) {
        console.log(`üîß Fixed Mojibake (Buffer): "${text}" ‚Üí "${decoded}"`)
        return decoded
      }
    }
  } catch (e) {
    console.warn('‚ö†Ô∏è Buffer decode failed:', e)
  }

  // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å Latin-1 ‡πÄ‡∏õ‡πá‡∏ô UTF-8
  try {
    const latin1Bytes = new Uint8Array(text.split('').map(c => c.charCodeAt(0)))
    const utf8String = new TextDecoder('latin1').decode(latin1Bytes)
    
    if (utf8String !== text && !utf8String.includes('√†¬∏')) {
      console.log(`üîß Fixed Mojibake (Latin-1): "${text}" ‚Üí "${utf8String}"`)
      return utf8String
    }
  } catch (e) {
    console.warn('‚ö†Ô∏è Latin-1 decode failed:', e)
  }

  // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
  console.warn(`‚ö†Ô∏è Could not fix Mojibake encoding for: "${text}"`)
  return text
}
```

### 2. **‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô FileUploadEdit.jsx**
```javascript
// ‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô state
const normalizedFiles = arr.map((file, index) => {
  console.log(`üîç [FileUploadEdit] file[${index}]:`, file)
  
  // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç UTF-8 encoding ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
  const fileName = fixMojibakeEncoding(file.namefile || file.name || file.originalName || `file_${index}`)
  
  return {
    name: fileName,
    url: file.url,
    size: file.size,
    type: file.fileType || file.type
  }
})
```

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### Test Case 1: Mojibake Detection
```javascript
const problematicFileName = '√†¬∏¬™√†¬∏¬£√†¬∏¬∏√†¬∏√†¬π√†¬∏√†¬∏¬•√†¬∏√†¬π√†¬∏¬ß√†¬∏¬•√†¬∏¬≤√†¬∏¬≠√†¬π√†¬∏¬≤√†¬∏√†¬π√†¬∏√†¬π√†¬∏√†¬∏√†¬π√†¬∏¬≥√†¬∏√†¬π√†¬∏¬≥√†¬∏√†¬∏¬≠√†¬∏.pdf'
const hasMojibake = problematicFileName.includes('√†¬∏') // true
```

### Test Case 2: Buffer Conversion
```javascript
const buffer = Buffer.from(problematicFileName, 'latin1')
const decoded = buffer.toString('utf8')
// ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: "‡∏™‡∏£‡∏∏‡∏•‡∏ß‡∏•‡∏≤‡∏≠‡∏≤‡∏≥‡∏≥‡∏≠.pdf"
```

### Test Case 3: TextDecoder
```javascript
const latin1Bytes = new Uint8Array(problematicFileName.split('').map(c => c.charCodeAt(0)))
const utf8String = new TextDecoder('latin1').decode(latin1Bytes)
// ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: "‡∏™‡∏£‡∏∏‡∏•‡∏ß‡∏•‡∏≤‡∏≠‡∏≤‡∏≥‡∏≥‡∏≠.pdf"
```

## üìä ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- ‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Mojibake
- ‚ùå ‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
- ‚ùå UI ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- ‚úÖ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô)
- ‚úÖ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ
- ‚úÖ UI ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ: `"‡∏™‡∏£‡∏∏‡∏•‡∏ß‡∏•‡∏≤‡∏≠‡∏≤‡∏≥‡∏≥‡∏≠.pdf"`
- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: `"‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡πà‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡πâ‡∏≥‡∏ô‡πâ‡∏≥‡∏ö‡∏≠‡∏á.pdf"`
- ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô `` (replacement character)

### ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
1. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏ô
2. **‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á encoding ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
3. **UTF-8 bytes ‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå**: ‡∏ö‡∏≤‡∏á bytes ‡∏≠‡∏≤‡∏à‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î

## üîß ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

### 1. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**
```sql
SELECT namefile, LENGTH(namefile), HEX(namefile) FROM uploads WHERE namefile LIKE '%√†¬∏%';
```

### 2. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ charset ‡∏Ç‡∏≠‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ charset ‡∏Ç‡∏≠‡∏á API response
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ charset ‡∏Ç‡∏≠‡∏á frontend

### 3. **‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£ mapping**
```javascript
const thaiCharMap = {
  '√†¬∏¬™': '‡∏™',
  '√†¬∏¬£': '‡∏£',
  '√†¬∏¬∏': '‡∏∏',
  // ... mapping ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
}
```

## üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

1. **`src/components/featureUi/FileUploadEdit.jsx`**
   - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `fixMojibakeEncoding`
   - ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ normalize ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå

## üöÄ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ edit ‡∏Ç‡∏≠‡∏á building control
2. ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ Mojibake ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
3. ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)

## üîç Debug Information

‡πÉ‡∏ä‡πâ console.log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°:
- `üîß Fixed Mojibake (Buffer): "..." ‚Üí "..."`
- `üîß Fixed Mojibake (Latin-1): "..." ‚Üí "..."`
- `‚ö†Ô∏è Could not fix Mojibake encoding for: "..."`

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô temporary solution
- ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á (‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/API) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô browser environment ‡∏ó‡∏µ‡πà‡∏°‡∏µ Buffer support
