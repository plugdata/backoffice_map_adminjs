# 📋 Flow การส่งเอกสาร - ระบบ Global AdminJS

## 🔄 ขั้นตอนการทำงาน (Document Approval Workflow)

### 1. ผู้ส่ง (Employees)
- **เลือกประเภทเอกสาร**: ใบขออนุมัติซื้อ, ใบเบิกวัสดุ, ใบลา, ใบเสนอโครงการ
- **กรอกข้อมูล**:
  - รหัสเอกสาร (Document Code)
  - ชื่อโครงการ (Project Name)
  - รายละเอียด (Details)
  - ชั้นความลับ (Confidentiality Level)
  - แผนก (Department)
- **แนบไฟล์**: PDF, DOC, DOCX, PNG, JPEG (สูงสุด 10MB)
- **ส่งเอกสาร** → สถานะเริ่มต้น = "รอตรวจสอบ HR"

### 2. HR (Admin)
- **ตรวจสอบเอกสาร**: รายละเอียด ความครบถ้วน
- **ตัดสินใจ**:
  - ✅ **ผ่าน** → สถานะ = "รออนุมัติ CEO"
  - ❌ **ไม่ผ่าน** → สถานะ = "ไม่อนุมัติ (HR)" + เหตุผลไม่อนุมัติ

### 3. CEO (Superadmin)
- **ตรวจเอกสารขั้นสุดท้าย**
- **ตัดสินใจ**:
  - ✅ **ผ่าน** → สถานะ = "อนุมัติแล้ว"
  - ❌ **ไม่ผ่าน** → สถานะ = "ไม่อนุมัติ (CEO)" + เหตุผลไม่อนุมัติ

### 4. HR (Final Step)
- **บันทึกผลการอนุมัติ/ไม่อนุมัติ**
- **แจ้งกลับผู้ส่ง** พร้อมเหตุผลถ้าไม่ผ่าน

## 🔄 Flow Diagram

```
[ผู้ส่ง/Employees] 
   ↓
   กรอกข้อมูลเอกสาร + แนบไฟล์
   ↓
   ส่งเอกสาร
   ↓
[HR/Admin] 
   ↓
   ตรวจสอบ (ผ่าน? / ไม่ผ่าน)
   ↓
   ถ้าผ่าน → ส่งต่อ [CEO/Superadmin]
   ↓
   ตรวจสอบ (ผ่าน? / ไม่ผ่าน)
   ↓
   แจ้งผลกลับ HR 
   ↓
   HR แจ้งผู้ส่ง
   ↓
   ถ้าไม่ผ่าน → HR แจ้งผู้ส่ง พร้อมเหตุผล
```

## 🗄️ โครงสร้างข้อมูล (Database Schema)

### Table: documents
| Field | Type | รายละเอียด |
|-------|------|-----------|
| id | PK | รหัสเอกสาร (Auto) |
| document_code | String | รหัสที่ส่งเอกสาร |
| document_type_id | FK | ประเภทเอกสาร |
| project_name | String | ชื่อโครงการ |
| details | Text | รายละเอียดปลีกย่อย |
| confidentiality_level_id | FK | ชั้นความลับ |
| department_id | FK | แผนกที่เกี่ยวข้อง |
| status | Enum | สถานะเอกสาร |
| rejection_reason | Text | เหตุผลไม่อนุมัติ |
| creator_id | FK | ใครเป็นคนส่ง |
| file_name | String | ชื่อไฟล์แนบ |
| file_size | Int | ขนาดไฟล์ |
| mime_type | String | ประเภทไฟล์ |
| file_path | String | ที่อยู่ไฟล์ |
| created_at | DateTime | วันที่ส่ง |
| updated_at | DateTime | วันที่แก้ไขล่าสุด |

### Table: document_types
| Field | รายละเอียด |
|-------|-----------|
| id | PK |
| name | ชื่อประเภทเอกสาร |
| description | รายละเอียดประเภท |
| is_active | สถานะใช้งาน |

### Table: confidentiality_levels
| Field | รายละเอียด |
|-------|-----------|
| id | PK |
| name | เช่น "ปกติ", "ลับ", "ลับมาก" |
| description | คำอธิบายเพิ่มเติม |
| is_active | สถานะใช้งาน |

### Table: departments
| Field | รายละเอียด |
|-------|-----------|
| id | PK |
| name | ชื่อแผนก |
| description | หน้าที่/ความรับผิดชอบของแผนก |
| manager_id | FK (employee_id) |
| is_active | สถานะใช้งาน |

### Table: users
| Field | รายละเอียด |
|-------|-----------|
| id | PK |
| email | อีเมล |
| username | ชื่อผู้ใช้ |
| password | รหัสผ่าน (เข้ารหัส) |
| first_name | ชื่อ |
| last_name | นามสกุล |
| employee_id | รหัสพนักงาน |
| department_id | FK แผนก |
| is_active | ทำงานอยู่ / ลาออก |
| last_login_at | วันที่เข้าสู่ระบบล่าสุด |

### Table: document_history
| Field | รายละเอียด |
|-------|-----------|
| id | PK |
| document_id | FK |
| action_by | FK (user_id) |
| action | เช่น ส่งเอกสาร, ตรวจสอบ, อนุมัติ, ไม่อนุมัติ |
| remark | หมายเหตุ เช่น เหตุผลไม่อนุมัติ |
| action_date | วันที่ทำ |

### Table: notifications
| Field | รายละเอียด |
|-------|-----------|
| id | PK |
| user_id | FK |
| type | ประเภทการแจ้งเตือน |
| title | หัวข้อ |
| message | ข้อความ |
| read | อ่านแล้วหรือยัง |
| document_id | FK (ถ้าเกี่ยวข้องกับเอกสาร) |
| created_at | วันที่สร้าง |
| read_at | วันที่อ่าน |

## 👥 Role Setting

### user (Employees)
- ส่งเอกสาร
- ดูสถานะของเอกสารตัวเอง
- ดูประวัติการส่ง
- เปลี่ยนรหัสผ่าน

### admin (HR)
- ตรวจสอบเอกสาร
- เปลี่ยนสถานะเป็น "รออนุมัติ CEO" หรือ "ไม่อนุมัติ"
- ระบุเหตุผลไม่อนุมัติ
- จัดการผู้ใช้ในแผนก
- ดูรายงานเอกสาร

### manager (Department Manager)
- ดูเอกสารในแผนก
- ส่งเอกสาร
- จัดการผู้ใช้ในแผนก

### ceo (CEO / Super Admin)
- อนุมัติ/ไม่อนุมัติขั้นสุดท้าย
- ระบุเหตุผล
- ส่งผลกลับ HR
- เข้าถึงทุกฟีเจอร์
- จัดการระบบทั้งหมด

## 🔔 ระบบแจ้งเตือน

### ประเภทการแจ้งเตือน
- **DOCUMENT_SUBMITTED**: เอกสารถูกส่งแล้ว
- **DOCUMENT_HR_REVIEWED**: HR ตรวจสอบแล้ว
- **DOCUMENT_CEO_APPROVED**: CEO อนุมัติแล้ว
- **DOCUMENT_REJECTED**: เอกสารถูกปฏิเสธ
- **DOCUMENT_STATUS_CHANGED**: สถานะเอกสารเปลี่ยน
- **SYSTEM_MESSAGE**: ข้อความระบบ

### วิธีการแจ้งเตือน
- **Dashboard Notifications**: แจ้งเตือนในหน้าเว็บ
- **Email Notifications**: แจ้งเตือนทางอีเมล (พร้อมใช้งาน)
- **Real-time Updates**: อัปเดตแบบเรียลไทม์

## 🔍 ระบบค้นหาและกรอง

### ค้นหาเอกสาร
- ตามรหัสเอกสาร
- ตามประเภทเอกสาร
- ตามแผนก
- ตามสถานะ
- ตามผู้ส่ง
- ตามช่วงวันที่

### กรองข้อมูล
- สถานะเอกสาร
- ประเภทเอกสาร
- แผนก
- ชั้นความลับ
- ช่วงวันที่

## 📊 รายงาน

### รายงานแยกตาม
- **แผนก**: จำนวนเอกสารต่อแผนก
- **สถานะ**: สถิติสถานะเอกสาร
- **ประเภท**: จำนวนเอกสารต่อประเภท
- **ผู้ส่ง**: เอกสารที่ส่งโดยผู้ใช้แต่ละคน
- **ช่วงเวลา**: เอกสารในช่วงเวลาที่กำหนด

### สถิติ
- จำนวนเอกสารทั้งหมด
- จำนวนเอกสารที่อนุมัติ
- จำนวนเอกสารที่ปฏิเสธ
- จำนวนเอกสารที่รอการอนุมัติ
- อัตราการอนุมัติ

## 📁 ระบบไฟล์

### การอัปโหลดไฟล์
- **รองรับไฟล์**: PDF, DOC, DOCX, PNG, JPEG, TXT
- **ขนาดไฟล์สูงสุด**: 10MB
- **การจัดเก็บ**: Local storage ใน `/public/uploads/`
- **การจัดการ**: จัดเก็บตาม document ID

### ความปลอดภัย
- ตรวจสอบประเภทไฟล์
- ตรวจสอบขนาดไฟล์
- ป้องกันการอัปโหลดไฟล์อันตราย
- เข้ารหัสชื่อไฟล์

## 🔐 ความปลอดภัย

### Authentication
- JWT Token Authentication
- Password Hashing (bcryptjs)
- Session Management
- Token Expiration

### Authorization
- Role-based Access Control (RBAC)
- Permission-based Access
- Resource-level Security
- API Endpoint Protection

### Data Protection
- SQL Injection Prevention (Prisma)
- XSS Protection
- CSRF Protection
- Input Validation
- Output Sanitization

## 🚀 การใช้งาน

### สำหรับผู้ส่ง (Employee)
1. เข้าสู่ระบบด้วย username/password
2. ไปที่หน้า "เอกสาร"
3. คลิก "สร้างใหม่"
4. กรอกข้อมูลเอกสาร
5. อัปโหลดไฟล์แนบ (ถ้ามี)
6. ส่งเอกสาร
7. ติดตามสถานะในหน้า "เอกสารของฉัน"

### สำหรับ HR
1. เข้าสู่ระบบด้วยสิทธิ์ admin
2. ไปที่หน้า "เอกสาร"
3. ดูเอกสารที่มีสถานะ "รอตรวจสอบ HR"
4. ตรวจสอบรายละเอียดเอกสาร
5. อนุมัติหรือปฏิเสธ
6. กรอกเหตุผล (ถ้าปฏิเสธ)

### สำหรับ CEO
1. เข้าสู่ระบบด้วยสิทธิ์ ceo
2. ไปที่หน้า "เอกสาร"
3. ดูเอกสารที่มีสถานะ "รออนุมัติ CEO"
4. ตรวจสอบรายละเอียดเอกสาร
5. อนุมัติหรือปฏิเสธขั้นสุดท้าย
6. กรอกเหตุผล (ถ้าปฏิเสธ)

## 📱 User Interface

### Login Page
```
┌─────────────────────────┐
│     🔐 Login Form       │
├─────────────────────────┤
│ Email: [____________]    │
│ Password: [_________]   │
│ [Login Button]          │
└─────────────────────────┘
```

### Document Creation
```
┌─────────────────────────────────────────┐
│ 📝 สร้างเอกสารใหม่                      │
├─────────────────────────────────────────┤
│ รหัสเอกสาร: [DOC-2024-001]              │
│ ประเภทเอกสาร: [Dropdown]                │
│ ชื่อโครงการ: [________________]          │
│ รายละเอียด: [Textarea]                  │
│ ชั้นความลับ: [Dropdown]                 │
│ แผนก: [Dropdown]                       │
│ แนบไฟล์: [Choose File]                  │
│ [ส่งเอกสาร] [ยกเลิก]                    │
└─────────────────────────────────────────┘
```

### Document List
```
┌─────────────────────────────────────────┐
│ 📋 รายการเอกสาร                         │
├─────────────────────────────────────────┤
│ [ค้นหา] [กรอง] [สร้างใหม่]              │
│ ┌─────────────────────────────────────┐ │
│ │ รหัส | ชื่อโครงการ | สถานะ | ผู้ส่ง  │ │
│ │ DOC-001 | โครงการ A | รอ HR | John  │ │
│ │ DOC-002 | โครงการ B | อนุมัติ | Jane │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Document Detail
```
┌─────────────────────────────────────────┐
│ 📄 รายละเอียดเอกสาร                     │
├─────────────────────────────────────────┤
│ รหัส: DOC-2024-001                     │
│ ชื่อโครงการ: โครงการซื้อคอมพิวเตอร์      │
│ สถานะ: รอตรวจสอบ HR                    │
│ ผู้ส่ง: John Doe (IT Department)       │
│ รายละเอียด: ขออนุมัติซื้อคอมพิวเตอร์... │
│ แนบไฟล์: proposal.pdf                  │
│ ┌─────────────────────────────────────┐ │
│ │ 📋 ประวัติการดำเนินการ              │ │
│ │ 2024-01-15 10:30 - ส่งเอกสาร        │ │
│ │ 2024-01-15 14:20 - HR ตรวจสอบผ่าน   │ │
│ └─────────────────────────────────────┘ │
│ [อนุมัติ] [ปฏิเสธ] [กลับ]               │
└─────────────────────────────────────────┘
```

## 🔮 Future Enhancements

### ฟีเจอร์ที่วางแผนไว้
- **Real-time Notifications**: WebSocket สำหรับการแจ้งเตือนแบบเรียลไทม์
- **Advanced Search**: ค้นหาขั้นสูงด้วย Elasticsearch
- **Bulk Operations**: จัดการเอกสารหลายรายการพร้อมกัน
- **Export Functionality**: ส่งออกข้อมูลเป็น Excel, PDF
- **Mobile App**: แอปพลิเคชันมือถือ
- **Multi-language Support**: รองรับหลายภาษา
- **API Documentation**: Swagger/OpenAPI
- **Unit Testing**: การทดสอบอัตโนมัติ
- **CI/CD Pipeline**: การ deploy อัตโนมัติ
- **Email Notifications**: การแจ้งเตือนทางอีเมล
- **Document Templates**: เทมเพลตเอกสาร
- **Digital Signatures**: ลายเซ็นดิจิทัล
- **Workflow Customization**: ปรับแต่ง workflow
- **Audit Trail**: ระบบติดตามการเปลี่ยนแปลง
- **Backup & Recovery**: ระบบสำรองข้อมูล

---

**📝 Note**: ระบบนี้ถูกออกแบบให้ขยายได้ง่ายและรองรับการใช้งานในองค์กรขนาดใหญ่ พร้อมระบบการส่งเอกสารและการอนุมัติที่ครบครัน 